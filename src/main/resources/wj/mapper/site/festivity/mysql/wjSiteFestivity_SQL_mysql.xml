<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="WjSiteFestivityDAO">

    <select id="getLastFesitivityId"
            parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO"
            resultType="String">

        SELECT FESTIVITY_ID
        FROM wj_festivity_info
        WHERE 1=1
        AND USE_YN = 'Y'
        AND DELETE_YN = 'N'
        ORDER BY FESTIVITY_ID DESC
        LIMIT 1

    </select>

    <select id="getLastFesitivityYear"
            parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO"
            resultType="String">

        SELECT FESTIVITY_YEAR
        FROM wj_festivity_info
        WHERE 1=1
        AND USE_YN = 'Y'
        AND DELETE_YN = 'N'
        ORDER BY FESTIVITY_ID DESC
        LIMIT 1

    </select>



    <select id="getSelectSiteFestivityInfo"
            parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO"
            resultType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO">

        SELECT A.FESTIVITY_NM
              ,A.FESTIVITY_NEMO
              ,A.PAGE_STR_DAY
              ,A.PAGE_END_DAY
              ,A.FESTIVITY_STR_DAY
              ,A.FESTIVITY_END_DAY
              ,A.FESTIVITY_IMAGE
              ,A.LAT				AS LATITUDE
              ,A.LONG				AS LONGITUDE
              ,B.LANG_CODE
              ,B.FESTIVITY_PLACE
              ,B.FESTIVITY_SCALE
              ,B.FESTIVITY_SUBJECT
              ,B.FESTIVITY_HOST
              ,B.FESTIVITY_SUPERVISES
              ,B.FESTIVITY_SITUATION
              ,B.TEMP1
              ,B.TEMP2
              ,B.TEMP3
              ,B.TEMP4
              ,B.TEMP5
              ,A.FESTIVITY_ID
              ,A.FESTIVITY_YEAR
              ,SUBSTR(FESTIVITY_STR_DAY, 1,4)   as FESTIVITY_START_YYYY
              ,SUBSTR(FESTIVITY_STR_DAY, 5,2) 	 as FESTIVITY_START_MM
              ,SUBSTR(FESTIVITY_STR_DAY, 7,2) 	 as FESTIVITY_START_DD
              ,SUBSTR(FESTIVITY_END_DAY, 1,4)   as FESTIVITY_END_YYYY
        	  ,SUBSTR(FESTIVITY_END_DAY, 5,2) 	 as FESTIVITY_END_MM
              ,SUBSTR(FESTIVITY_END_DAY, 7,2) 	 as FESTIVITY_END_DD
              ,CONCAT('WEEKDAY.00',WEEKDAY(FESTIVITY_STR_DAY)) as FESTIVITY_STR_WEEKDAY
              ,CONCAT('WEEKDAY.00',WEEKDAY(FESTIVITY_END_DAY)) as FESTIVITY_END_WEEKDAY

        FROM WJ_FESTIVITY_INFO A
           ,WJ_FESTIVITY_LANG B
        WHERE 1=1
        AND A.FESTIVITY_ID =B.FESTIVITY_ID
        AND A.FESTIVITY_ID =#{festivityId}
        AND B.LANG_CODE =#{langCode}
    </select>


    <select id="getSelectSiteFestivityInfoList"
            parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO"
            resultType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO">

        SELECT A.FESTIVITY_NM
              ,A.FESTIVITY_NEMO
              ,A.PAGE_STR_DAY
              ,A.PAGE_END_DAY
              ,A.FESTIVITY_STR_DAY
              ,A.FESTIVITY_END_DAY
              ,A.FESTIVITY_IMAGE
              ,A.LAT				AS LATITUDE
              ,A.LONG				AS LONGITUDE
              ,B.LANG_CODE
              ,B.FESTIVITY_PLACE
              ,B.FESTIVITY_SCALE
              ,B.FESTIVITY_SUBJECT
              ,B.FESTIVITY_HOST
              ,B.FESTIVITY_SUPERVISES
              ,B.FESTIVITY_SITUATION
              ,B.TEMP1
              ,B.TEMP2
              ,B.TEMP3
              ,B.TEMP4
              ,B.TEMP5
              ,A.FESTIVITY_ID
              ,A.FESTIVITY_YEAR
              ,SUBSTR(FESTIVITY_STR_DAY, 1,4)   as FESTIVITY_START_YYYY
              ,SUBSTR(FESTIVITY_STR_DAY, 5,2) 	 as FESTIVITY_START_MM
              ,SUBSTR(FESTIVITY_STR_DAY, 7,2) 	 as FESTIVITY_START_DD
              ,SUBSTR(FESTIVITY_END_DAY, 1,4)   as FESTIVITY_END_YYYY
        	  ,SUBSTR(FESTIVITY_END_DAY, 5,2) 	 as FESTIVITY_END_MM
              ,SUBSTR(FESTIVITY_END_DAY, 7,2) 	 as FESTIVITY_END_DD
              ,CONCAT('WEEKDAY.00',WEEKDAY(FESTIVITY_STR_DAY)) as FESTIVITY_STR_WEEKDAY
              ,CONCAT('WEEKDAY.00',WEEKDAY(FESTIVITY_END_DAY)) as FESTIVITY_END_WEEKDAY
        FROM WJ_FESTIVITY_INFO A
           ,WJ_FESTIVITY_LANG B
        WHERE 1=1
        AND A.FESTIVITY_ID =B.FESTIVITY_ID
        AND A.FESTIVITY_YEAR =#{festivityYear}
        AND B.LANG_CODE =#{langCode}
    </select>





    <select id="getSelectSiteFestivityYearList" parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO" resultType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO">


            select FESTIVITY_YEAR
                  ,FESTIVITY_CNT
                  ,FESTIVITY_TOT_CNT
                  ,IFNULL(FN_FESTIVITY_YEAR(next_up),0) as NEXT_UP
                  ,IFNULL(FN_FESTIVITY_YEAR(next_down),0) AS NEXT_DOWN
            from (
            select FESTIVITY_YEAR
                   ,FESTIVITY_CNT
                    ,FESTIVITY_CNT+1 as next_up
                     ,FESTIVITY_CNT -1 as next_down
                   ,(select count(*) as cnt from wj_festivity_info where 1=1
                    and USE_YN ='Y'
                    and DELETE_YN ='N') as  FESTIVITY_TOT_CNT

            from (
            select FESTIVITY_YEAR
                  ,@ROWNUM:=@ROWNUM+1 AS FESTIVITY_CNT
             from (
            select FESTIVITY_YEAR
                from wj_festivity_info
            where 1=1
            and USE_YN ='Y'
            and DELETE_YN ='N'
            order by FESTIVITY_YEAR asc
            ) a ,(SELECT @ROWNUM:=0) R
            )a where 1=1
            order by FESTIVITY_YEAR desc
            ) A
            where 1=1

    </select>






    <select id="getSelectSiteWjFestivitySchedule"
            parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO"
            resultType="wj.com.site.festivity.vo.WjSiteFestivityScheduleVO">


                SELECT A.FESTIVITY_ID
                      ,A.SCHEDULE_SNO
                      ,A.SCHEDULE_DAY
                      ,A.SCHEDULE_STR_TIME
                      ,A.SCHEDULE_END_TIME
                      ,A.TITLE
                      ,A.MEO
                      ,A.ORDER_CNT
                      ,A.USE_YN
                      ,A.DELETE_YN
                      ,B.LANG_CODE
                      ,B.SCHEDULE_TITLE
                      ,B.SCHEDULE_PROGRAM
                      ,B.SCHEDULE_PLACE

                FROM WJ_FESTIVITY_SCHEDULE A
                    ,WJ_FESTIVITY_SCHEDULE_LANG B
                WHERE 1=1
                AND A.SCHEDULE_SNO =B.SCHEDULE_SNO
                AND A.USE_YN ='Y'
                AND A.DELETE_YN='N'
                AND A.FESTIVITY_ID =#{festivityId}
                AND B.LANG_CODE =#{langCode}
                ORDER BY A.ORDER_CNT ASC

    </select>


    <select id="getSelectSiteWjSiteFestivityApplicationList"
            parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO"
            resultType="wj.com.site.festivity.vo.WjSiteFestivityApplicationVO">


        select A.FESTIVITY_ID
                ,A.APPLICATION_ID
                ,A.APPLICATION_GB
                ,A.APPLICATION_NM
                ,A.APPLICATION_CONTENT
                ,A.APPLICATION_MEMO
                ,A.APPLICATION_STR_DT
                ,A.APPLICATION_ENT_DT
                ,B.LANG_CODE
                ,B.APPLICATION_TITLE
                ,B.CONTENT_INFO
                ,B.MEMO
                from WJ_FESTIVITY_APPLICATION A
                ,wj_festivity_application_lang B
                where 1=1
                and A.FESTIVITY_ID =B.FESTIVITY_ID
                and b.LANG_CODE =#{langCode}
                and A.FESTIVITY_ID =#{festivityId}
               <![CDATA[
                AND A.APPLICATION_STR_DT <=DATE_FORMAT(SYSDATE(), '%Y%m%d%h%m')
                AND A.APPLICATION_ENT_DT>=DATE_FORMAT(SYSDATE(), '%Y%m%d%h%m')
             ]]>


    </select>




    <select id="getMainFesitivityList"  parameterType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO" resultType="wj.com.site.festivity.vo.WjSiteFestivityInfoVO">


            select   B.FESTIVITY_ID
                    ,B.LANG_CODE
                    ,B.FESTIVITY_PLACE
                    ,B.FESTIVITY_SCALE
                    ,B.FESTIVITY_SUBJECT
                    ,B.FESTIVITY_HOST
                    ,B.FESTIVITY_SUPERVISES
                    ,B.FESTIVITY_SITUATION
                    ,A.FESTIVITY_STR_DAY
                    ,A.FESTIVITY_END_DAY
                    ,A.FESTIVITY_YEAR
                    ,A.FESTIVITY_IMAGE
                from wj_festivity_info A
                ,wj_festivity_lang B
                where 1=1
                and A.FESTIVITY_ID =B.FESTIVITY_ID
                and B.LANG_CODE =#{langCode}

                   <![CDATA[
                AND A.PAGE_STR_DAY <=DATE_FORMAT(SYSDATE(), '%Y%m%d%h%m')
                AND A.PAGE_END_DAY>=DATE_FORMAT(SYSDATE(), '%Y%m%d%h%m')
                   ]]>




    </select>






</mapper>