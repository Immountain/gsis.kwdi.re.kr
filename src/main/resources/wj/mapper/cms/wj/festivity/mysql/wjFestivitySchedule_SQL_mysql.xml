<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="WjFestivityScheduleDAO">

    <select id="selectFestivitySchedule"
            parameterType="wj.com.cms.wj.festivity.vo.WjFestivityScheduleVO"
            resultType="wj.com.cms.wj.festivity.vo.WjFestivityScheduleVO">

        SELECT
             FS.FESTIVITY_ID
            ,FS.SCHEDULE_SNO
            ,FS.SCHEDULE_DAY
            ,FS.SCHEDULE_STR_TIME
            ,FS.SCHEDULE_END_TIME
            ,FS.TITLE
            ,FS.MEO
            ,FS.ORDER_CNT
            ,FS.USE_YN
            ,FS.DELETE_YN
            ,FS.REG_ID
            ,FS.REG_DT
            ,FS.MOD_ID
            ,FS.MOD_DT
        FROM WJ_FESTIVITY_SCHEDULE FS
        WHERE 1=1
            AND FS.FESTIVITY_ID = #{festivityId}
            AND FS.SCHEDULE_SNO = #{scheduleSno}
    </select>

    <select id="selectFestivityScheduleTotalCount"
            parameterType="wj.com.cms.wj.festivity.vo.WjFestivityScheduleVO"
            resultType="int">
        SELECT COUNT(*) totcnt
        FROM WJ_FESTIVITY_SCHEDULE FS
        WHERE 1=1
        AND FS.FESTIVITY_ID = #{festivityId}
        AND FS.DELETE_YN = 'N'
        <if test="searchCondition == 1">AND
            FS.TITLE LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>

    </select>

    <select id="selectFestivityScheduleList"
            parameterType="wj.com.cms.wj.festivity.vo.WjFestivityScheduleVO"
            resultType="wj.com.cms.wj.festivity.vo.WjFestivityScheduleVO">
        SELECT
             FS.FESTIVITY_ID
            ,FS.SCHEDULE_SNO
            ,FS.SCHEDULE_DAY
            ,FS.SCHEDULE_STR_TIME
            ,FS.SCHEDULE_END_TIME
            ,FS.TITLE
            ,FS.MEO
            ,FS.ORDER_CNT
            ,FS.USE_YN
            ,FS.DELETE_YN
            ,FS.REG_ID
            ,FS.REG_DT
            ,FS.MOD_ID
            ,FS.MOD_DT
        FROM WJ_FESTIVITY_SCHEDULE FS
        WHERE 1=1
        AND FS.FESTIVITY_ID = #{festivityId}
        AND FS.DELETE_YN = 'N'
        <if test="searchCondition == 1">AND
            FS.TITLE LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>
        ORDER BY FS.ORDER_CNT
        LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

    <insert id="insertFestivitySchedule">
		<![CDATA[
        INSERT INTO  WJ_FESTIVITY_SCHEDULE (
             FESTIVITY_ID
            ,SCHEDULE_SNO
            ,SCHEDULE_DAY
            ,SCHEDULE_STR_TIME
            ,SCHEDULE_END_TIME
            ,TITLE
            ,MEO
            ,ORDER_CNT
            ,USE_YN
            ,DELETE_YN
            ,REG_ID
            ,REG_DT
        ) VALUES (
            #{festivityId}
           ,#{scheduleSno}
            ,REPLACE(#{scheduleDay},'-','')
           ,#{scheduleStrTime}
           ,#{scheduleEndTime}
           ,#{title}
           ,#{meo}
           ,#{orderCnt}
           ,#{useYn}
           ,'N'
           ,#{regId}
           ,NOW()
                 )
        ]]>
	</insert>

    <update id="updateFestivitySchedule">
        UPDATE WJ_FESTIVITY_SCHEDULE SET
             FESTIVITY_ID = #{festivityId}
            ,SCHEDULE_SNO = #{scheduleSno}
            ,SCHEDULE_DAY = REPLACE(#{scheduleDay},'-','')
            ,SCHEDULE_STR_TIME = #{scheduleStrTime}
            ,SCHEDULE_END_TIME = #{scheduleEndTime}
            ,TITLE = #{title}
            ,MEO = #{meo}
            ,ORDER_CNT = #{orderCnt}
            ,USE_YN = #{useYn}
            ,MOD_ID = #{modId}
            ,MOD_DT = NOW()
        WHERE  1=1
          AND FESTIVITY_ID = #{festivityId}
          AND SCHEDULE_SNO = #{scheduleSno}
    </update>

    <update id ="deleteFestivitySchedule">
        UPDATE WJ_FESTIVITY_SCHEDULE SET
            DELETE_YN = 'Y'
        WHERE 1=1
        AND SCHEDULE_SNO = #{scheduleSno}
    </update>
</mapper>