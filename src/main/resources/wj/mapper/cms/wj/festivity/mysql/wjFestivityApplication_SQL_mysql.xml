<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="WjFestivityApplicationDAO">

    <select id="selectFestivityApplication"
            parameterType="wj.com.cms.wj.festivity.vo.WjFestivityApplicationVO"
            resultType="wj.com.cms.wj.festivity.vo.WjFestivityApplicationVO">
        SELECT
             FA.FESTIVITY_ID
            ,FA.APPLICATION_ID
            ,FA.APPLICATION_GB
            ,FA.APPLICATION_NM
            ,FA.APPLICATION_CONTENT
            ,FA.APPLICATION_MEMO
            ,FA.APPLICATION_STR_DT
            ,FA.APPLICATION_ENT_DT
            ,FA.USE_YN
            ,FA.REG_ID
            ,FA.REG_DT
            ,FA.MOD_ID
            ,FA.MOD_DT
            ,FI.FESTIVITY_NM
        FROM WJ_FESTIVITY_APPLICATION FA
        INNER JOIN WJ_FESTIVITY_INFO FI
        ON FA.FESTIVITY_ID = FI.FESTIVITY_ID
        WHERE 1=1
          AND FA.APPLICATION_ID =#{applicationId}
    </select>
    <select id="selectFestivityApplicationTotalCount"
        parameterType="wj.com.cms.wj.festivity.vo.WjFestivityApplicationVO"
        resultType="int">
        SELECT COUNT(*) totcnt
        FROM WJ_FESTIVITY_APPLICATION FA
        WHERE 1=1
        <if test="searchCondition == 0">
            AND FA.APPLICATION_NM LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>
        <if test="searchCondition == 1">
            AND FA.APPLICATION_GB LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>

    </select>
    <select id="selectFestivityApplicationList"
        parameterType="wj.com.cms.wj.festivity.vo.WjFestivityApplicationVO"
        resultType="wj.com.cms.wj.festivity.vo.WjFestivityApplicationVO">
        SELECT
             FA.FESTIVITY_ID
            ,FA.APPLICATION_ID
            ,FA.APPLICATION_GB
            ,FA.APPLICATION_NM
            ,FA.APPLICATION_CONTENT
            ,FA.APPLICATION_MEMO
            ,FA.APPLICATION_STR_DT
            ,FA.APPLICATION_ENT_DT
            ,FA.USE_YN
            ,FA.REG_ID
            ,FA.REG_DT
            ,FA.MOD_ID
            ,FA.MOD_DT
        FROM WJ_FESTIVITY_APPLICATION FA
        WHERE 1=1
        <if test="searchCondition == 0">
            AND FA.APPLICATION_NM LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>
        <if test="searchCondition == 1">
            AND FA.APPLICATION_GB LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>
        order by FA.REG_DT desc
        LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

    <insert id="insertFestivityApplication">
        <![CDATA[
            INSERT INTO WJ_FESTIVITY_APPLICATION(
                 FESTIVITY_ID
                ,APPLICATION_ID
                ,APPLICATION_GB
                ,APPLICATION_NM
                ,APPLICATION_CONTENT
                ,APPLICATION_MEMO
                ,APPLICATION_STR_DT
                ,APPLICATION_ENT_DT
                ,USE_YN
                ,REG_ID
                ,REG_DT
            ) VALUES (
                  #{festivityId}
                 ,#{applicationId}
                 ,#{applicationGb}
                 ,#{applicationNm}
                 ,#{applicationContent}
                 ,#{applicationMemo}
                 ,REPLACE(#{applicationStrDt},"-","")
                 ,REPLACE(#{applicationEntDt},"-","")
                 ,#{useYn}
                 ,#{regId}
                 ,NOW()
                     )
        ]]>
    </insert>
    <update id="updateFestivityApplication">
        UPDATE WJ_FESTIVITY_APPLICATION SET
             FESTIVITY_ID = #{festivityId}
            ,APPLICATION_ID = #{applicationId}
            ,APPLICATION_GB = #{applicationGb}
            ,APPLICATION_NM = #{applicationNm}
            ,APPLICATION_CONTENT = #{applicationContent}
            ,APPLICATION_MEMO = #{applicationMemo}
            ,APPLICATION_STR_DT = REPLACE(#{applicationStrDt},"-","")
            ,APPLICATION_ENT_DT = REPLACE(#{applicationEntDt},"-","")
            ,USE_YN = #{useYn}
            ,MOD_ID = #{modId}
            ,MOD_DT = NOW()
        WHERE 1=1
        AND APPLICATION_ID = #{applicationId}
    </update>
</mapper>