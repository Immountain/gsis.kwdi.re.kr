<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="WjJejuPeopleDAO">

    <resultMap id="WjJejuPeople" type="wj.com.cms.wj.jeju.vo.WjJejuPeopleVO" autoMapping="true">
        <collection property="wjActInfoList" column="USER_ID" javaType="java.util.ArrayList" ofType="wj.com.cms.wj.act.vo.WjActInfoVO" select="getActInfo"/>
    </resultMap>

    <select id="selectJejuPeople"
            parameterType="wj.com.cms.wj.jeju.vo.WjJejuPeopleVO"
            resultMap="WjJejuPeople">
        SELECT
             JP.USER_ID AS userId
            ,JP.KOR_NAME
            ,JP.EN_NAME
            ,JP.CN_NAME
            ,JP.ATCH_FILE_ID
            ,JP.SEX
            ,JP.BIRTH
            ,JP.CITY
            ,JP.TOWN
            ,JP.VILLAGE
            ,JP.ADDRESS_ETC
            ,JP.COUNTRY
            ,JP.COUNTRY_CITY
            ,JP.COUNTRY_ETC
            ,JP.PHONE
            ,JP.TEL1
            ,JP.TEL2
            ,JP.EMAILL
            ,JP.COMPANY
            ,JP.SPOT
            ,JP.SCHOOL_E
            ,JP.SCHOOL_E_YEAR
            ,JP.SCHOOL_M
            ,JP.SCHOOL_M_YEAR
            ,JP.SCHOOL_H
            ,JP.SCHOOL_H_YEAR
            ,JP.SCHOOL_U
            ,JP.SCHOOL_U_YEAR
            ,JP.SCHOOL_G
            ,JP.SCHOOL_G_YEAR
            ,JP.EDU
            ,JP.RELIGION
            ,JP.RELIGION_ETC
            ,JP.CAREER
            ,JP.REG_DT
            ,JP.REG_ID
            ,JP.REG_IP
            ,JP.MOD_DT
            ,JP.MOD_ID
            ,JP.MOD_IP
            ,JP.SEND_EMAILL_YN
            ,FN_COUNTRY_NM(CITY) AS CITY_NM
            ,FN_COUNTRY_NM(TOWN) AS TOWN_NM
            ,FN_COUNTRY_NM(VILLAGE) AS VILLAGE_NM
            ,FN_CODE_NM('WJ_10',EDU) AS EDU_NM
            ,FN_CODE_NM('WJ_30',RELIGION) AS RELIGION_NM
            ,FN_CODE_NM('NATION',COUNTRY) AS COUNTRY_NM
        FROM WJ_JEJU_PEOPLE JP
        WHERE 1=1
          AND JP.USER_ID = #{userId}
    </select>

    <select id="getActInfo"
            parameterType="wj.com.cms.wj.act.vo.WjActInfoVO"
            resultType="wj.com.cms.wj.act.vo.WjActInfoVO">
        SELECT
            AI.USER_ID,
            AI.ACT_CODE
        FROM WJ_ACT_INFO AI
        WHERE 1=1
        AND USER_ID = #{userId}
    </select>

    <select id="selectJejuPeopleTotalCount"
        parameterType="wj.com.cms.wj.jeju.vo.WjJejuPeopleVO"
        resultType="int">
        SELECT COUNT(*) totcnt
        FROM WJ_JEJU_PEOPLE JP
        WHERE 1=1
        <if test="searchCondition == 1">AND
            JP.USER_ID LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>
        <if test="searchCondition == 2">AND
            JP.KOR_NAME LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>

    </select>
    <select id="selectJejuPeopleList"
        parameterType="wj.com.cms.wj.jeju.vo.WjJejuPeopleVO"
        resultType="wj.com.cms.wj.jeju.vo.WjJejuPeopleVO">
        SELECT
             JP.USER_ID
            ,JP.KOR_NAME
            ,JP.EN_NAME
            ,JP.CN_NAME
            ,JP.ATCH_FILE_ID
            ,JP.SEX
            ,JP.BIRTH
            ,JP.CITY
            ,JP.TOWN
            ,JP.VILLAGE
            ,JP.ADDRESS_ETC
            ,JP.COUNTRY
            ,JP.COUNTRY_CITY
            ,JP.COUNTRY_ETC
            ,JP.PHONE
            ,JP.TEL1
            ,JP.TEL2
            ,JP.EMAILL
            ,JP.COMPANY
            ,JP.SPOT
            ,JP.SCHOOL_E
            ,JP.SCHOOL_E_YEAR
            ,JP.SCHOOL_M
            ,JP.SCHOOL_M_YEAR
            ,JP.SCHOOL_H
            ,JP.SCHOOL_H_YEAR
            ,JP.SCHOOL_U
            ,JP.SCHOOL_U_YEAR
            ,JP.SCHOOL_G
            ,JP.SCHOOL_G_YEAR
            ,JP.EDU
            ,JP.RELIGION
            ,JP.RELIGION_ETC
            ,JP.CAREER
            ,JP.REG_DT
            ,JP.REG_ID
            ,JP.REG_IP
            ,JP.MOD_DT
            ,JP.MOD_ID
            ,JP.MOD_IP
            ,JP.SEND_EMAILL_YN
        FROM WJ_JEJU_PEOPLE JP
        WHERE 1=1
        <if test="searchCondition == 1">AND
            JP.USER_ID LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>
        <if test="searchCondition == 2">AND
            JP.KOR_NAME LIKE CONCAT('%' , #{searchKeyword}, '%')
        </if>
        order by JP.REG_DT desc
    </select>

    <insert id="insertJejuPeople">
        <![CDATA[
            INSERT INTO WJ_JEJU_PEOPLE(
                 USER_ID
                ,KOR_NAME
                ,EN_NAME
                ,CN_NAME
                ,ATCH_FILE_ID
                ,SEX
                ,BIRTH
                ,CITY
                ,TOWN
                ,VILLAGE
                ,ADDRESS_ETC
                ,COUNTRY
                ,COUNTRY_CITY
                ,COUNTRY_ETC
                ,PHONE
                ,TEL1
                ,TEL2
                ,EMAILL
                ,COMPANY
                ,SPOT
                ,SCHOOL_E
                ,SCHOOL_E_YEAR
                ,SCHOOL_M
                ,SCHOOL_M_YEAR
                ,SCHOOL_H
                ,SCHOOL_H_YEAR
                ,SCHOOL_U
                ,SCHOOL_U_YEAR
                ,SCHOOL_G
                ,SCHOOL_G_YEAR
                ,EDU
                ,RELIGION
                ,RELIGION_ETC
                ,CAREER
                ,REG_DT
                ,REG_ID
                ,REG_IP
                ,SEND_EMAILL_YN
                ,LANG_CODE
            ) VALUES (
                 #{userId}
                ,#{korName}
                ,#{enName}
                ,#{cnName}
                ,#{atchFileId}
                ,#{sex}
                ,REPLACE(#{birth}, '-', '')
                ,#{city}
                ,#{town}
                ,#{village}
                ,#{addressEtc}
                ,#{country}
                ,#{countryCity}
                ,#{countryEtc}
                ,#{phone}
                ,#{tel1}
                ,#{tel2}
                ,#{emaill}
                ,#{company}
                ,#{spot}
                ,#{schoolE}
                ,#{schoolEYear}
                ,#{schoolM}
                ,#{schoolMYear}
                ,#{schoolH}
                ,#{schoolHYear}
                ,#{schoolU}
                ,#{schoolUYear}
                ,#{schoolG}
                ,#{schoolGYear}
                ,#{edu}
                ,#{religion}
                ,#{religionEtc}
                ,#{career}
                ,NOW()
                ,#{regId}
                ,#{regIp}
                ,#{sendEmaillYn}
                ,#{langCode}

                     )
        ]]>
    </insert>
    <update id="updateJejuPeople">
        UPDATE WJ_JEJU_PEOPLE SET
             USER_ID = #{userId}
            ,KOR_NAME = #{korName}
            ,EN_NAME = #{enName}
            ,CN_NAME = #{cnName}
            ,ATCH_FILE_ID = #{atchFileId}
            ,SEX = #{sex}
            ,BIRTH = REPLACE(#{birth}, '-', '')
            ,CITY = #{city}
            ,TOWN = #{town}
            ,VILLAGE = #{village}
            ,ADDRESS_ETC = #{addressEtc}
            ,COUNTRY = #{country}
            ,COUNTRY_CITY = #{countryCity}
            ,COUNTRY_ETC = #{countryEtc}
            ,PHONE = #{phone}
            ,TEL1 = #{tel1}
            ,TEL2 = #{tel2}
            ,EMAILL = #{emaill}
            ,COMPANY = #{company}
            ,SPOT = #{spot}
            ,SCHOOL_E = #{schoolE}
            ,SCHOOL_E_YEAR = #{schoolEYear}
            ,SCHOOL_M = #{schoolM}
            ,SCHOOL_M_YEAR = #{schoolMYear}
            ,SCHOOL_H = #{schoolH}
            ,SCHOOL_H_YEAR = #{schoolHYear}
            ,SCHOOL_U = #{schoolU}
            ,SCHOOL_U_YEAR = #{schoolUYear}
            ,SCHOOL_G = #{schoolG}
            ,SCHOOL_G_YEAR = #{schoolGYear}
            ,EDU = #{edu}
            ,RELIGION = #{religion}
            ,RELIGION_ETC = #{religionEtc}
            ,CAREER = #{career}
            ,MOD_DT = NOW()
            ,MOD_ID = #{modId}
            ,MOD_IP = #{modIp}
            ,SEND_EMAILL_YN =#{sendEmaillYn}

        WHERE 1=1
        AND USER_ID = #{userId}
    </update>
    
    <delete id="getDeleteWjJejuPeoplePic">
        DELETE FROM WJ_JEJU_PEOPLE_PIC
        WHERE 1=1
        AND USER_ID = #{userId}
    </delete>


    <insert id="getInsertWjJejuPeoplePic">
        INSERT INTO WJ_JEJU_PEOPLE_PIC(
              USER_ID
            , PIC
        ) VALUES (
             #{userId}
            , #{pic}
        )
    </insert>


    <select id="getSelectWjJejuPeoplePic"  parameterType="String" resultType="wj.com.cms.wj.jeju.vo.WjJejuPeoplePicVO">

       select USER_ID
              ,PIC
        from wj_jeju_people_pic
        where 1=1
        and USER_ID =#{userId}


    </select>


    
</mapper>