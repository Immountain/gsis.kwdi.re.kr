<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="WjSubProgramDAO">

    <select id="selectSubProgram"
            parameterType="wj.com.cms.wj.sub.vo.WjSubProgramVO"
            resultType="wj.com.cms.wj.sub.vo.WjSubProgramVO">
        SELECT
             SP.FESTIVITY_ID
            ,SP.FESTIVITY_PROGRAM_SNO
            ,SP.TITLE
            ,SP.PAGE_TYPE
            ,SP.ATCH_FILE_ID
            ,SP.ORDER_CNT
            ,SP.USE_YN
            ,SP.DELETE_YN
            ,SP.REG_ID
            ,SP.REG_DT
            ,SP.MOD_ID
            ,SP.MOD_DT
            ,FI.FESTIVITY_NM
        FROM WJ_SUB_PROGRAM SP
        INNER JOIN WJ_FESTIVITY_INFO  FI
            ON FI.FESTIVITY_ID = SP.FESTIVITY_ID
        WHERE 1=1
          AND SP.FESTIVITY_PROGRAM_SNO = #{festivityProgramSno}
    </select>

    <select id="selectSubProgramTotalCount"
            parameterType="wj.com.cms.wj.sub.vo.WjSubProgramVO"
            resultType="int">
        SELECT COUNT(*) totcnt
        FROM WJ_SUB_PROGRAM SP
        INNER JOIN WJ_FESTIVITY_INFO FI
            ON SP.FESTIVITY_ID = FI.FESTIVITY_ID
        WHERE 1=1
        AND SP.DELETE_YN ='N'
        <if test = "searchCondition == 0">
            AND SP.TITLE LIKE CONCAT('%', #{searchKeyword} , '%')
        </if>
        <if test="@org.apache.commons.lang3.StringUtils@isNotEmpty(festivityId)">
            AND SP.FESTIVITY_ID = #{festivityId}
        </if>
    </select>

    <select id="selectSubProgramList"
            parameterType="wj.com.cms.wj.sub.vo.WjSubProgramVO"
            resultType="wj.com.cms.wj.sub.vo.WjSubProgramVO">
        SELECT
             SP.FESTIVITY_ID
            ,SP.FESTIVITY_PROGRAM_SNO
            ,SP.TITLE
            ,SP.PAGE_TYPE
            ,SP.ATCH_FILE_ID
            ,SP.ORDER_CNT
            ,SP.USE_YN
            ,SP.DELETE_YN
            ,SP.REG_ID
            ,SP.REG_DT
            ,SP.MOD_ID
            ,SP.MOD_DT
            ,FI.FESTIVITY_NM
        FROM WJ_SUB_PROGRAM SP
        INNER JOIN WJ_FESTIVITY_INFO FI
            ON SP.FESTIVITY_ID = FI.FESTIVITY_ID
        WHERE 1=1
            AND SP.DELETE_YN = 'N'

        <if test = "searchCondition == 0">
            AND SP.TITLE LIKE CONCAT('%', #{searchKeyword} , '%')
        </if>
        <if test="@org.apache.commons.lang3.StringUtils@isNotEmpty(festivityId)">
            AND SP.FESTIVITY_ID = #{festivityId}
        </if>

        LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

    <insert id="insertSubProgram">
		<![CDATA[
        INSERT INTO  WJ_SUB_PROGRAM (
             FESTIVITY_ID
            ,FESTIVITY_PROGRAM_SNO
            ,TITLE
            ,PAGE_TYPE
            ,ATCH_FILE_ID
            ,ORDER_CNT
            ,USE_YN
            ,DELETE_YN
            ,REG_ID
            ,REG_DT
        ) VALUES (
             #{festivityId}
            ,#{festivityProgramSno}
            ,#{title}
            ,#{pageType}
            ,#{atchFileId}
            ,#{orderCnt}
            ,#{useYn}
            ,'N'
            ,#{regId}
            ,NOW()
                 )
        ]]>
	</insert>

    <update id="updateSubProgram">
        UPDATE WJ_SUB_PROGRAM SET
             FESTIVITY_ID = #{festivityId}
            ,FESTIVITY_PROGRAM_SNO = #{festivityProgramSno}
            ,TITLE = #{title}
            ,PAGE_TYPE = #{pageType}
            ,ATCH_FILE_ID = #{atchFileId}
            ,ORDER_CNT = #{orderCnt}
            ,USE_YN = #{useYn}
            ,MOD_ID = #{modId}
            ,MOD_DT = NOW()
        WHERE  1=1
          AND FESTIVITY_PROGRAM_SNO = #{festivityProgramSno}
    </update>

    <update id="deleteSubProgram">
        UPDATE WJ_SUB_PROGRAM SET
            DELETE_YN = 'Y'
        WHERE 1=1
        AND FESTIVITY_PROGRAM_SNO = #{festivityProgramSno}
    </update>
</mapper>